{
    "raw_text": "package Code;\n\nimport javax.swing.*;\nimport java.awt.*;\nimport java.util.ArrayList;\n\npublic class ManagePurchasesGUI extends JFrame implements EmailNotif{\n    private JFrame frame;\n    private JPanel mainPanel;\n\n    public ManagePurchasesGUI() {\n        // Initialize components\n        frame = new JFrame(\"Manage Purchases\");\n        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);\n        frame.setSize(700, 450);\n\n        mainPanel = new JPanel();\n        mainPanel.setLayout(new BoxLayout(mainPanel, BoxLayout.Y_AXIS));\n\n        displayPurchases();\n\n        JScrollPane scrollPane = new JScrollPane(mainPanel);\n        frame.getContentPane().add(BorderLayout.CENTER, scrollPane);\n    }\n\n    private void displayPurchases() {\n        ArrayList<Purchase> purchases = DatabaseController.getPurchases(User.getEmail());\n    \n        for (Purchase purchase : purchases) {\n            JPanel purchasePanel = new JPanel();\n            purchasePanel.setLayout(new BoxLayout(purchasePanel, BoxLayout.X_AXIS));\n    \n            // Display purchase information using Purchase class functions\n            JTextArea purchaseInfo = new JTextArea();\n            purchaseInfo.append(\"Name: \" + purchase.getFirstName() + \" \" + purchase.getLastName() + \"\\n\");\n            purchaseInfo.append(\"Flight Number: \" + purchase.getFlightNumber() + \"\\n\");\n            purchaseInfo.append(\"Seat Number: \" + purchase.getSeatNumber() + \"\\n\");\n            purchaseInfo.append(\"Flight Start: \" + purchase.getFlightStart() + \"\\n\");\n            purchaseInfo.append(\"Flight Destination: \" + purchase.getFlightDestination() + \"\\n\");\n            purchaseInfo.append(\"Departure Date: \" + purchase.getDepartureDate().getFormattedDate() + \"\\n\");\n    \n            purchaseInfo.setEditable(false);\n            purchaseInfo.setLineWrap(true);\n            purchasePanel.add(purchaseInfo);\n    \n            // Add some space between purchase information and the \"Cancel\" button\n            purchasePanel.add(Box.createRigidArea(new Dimension(10, 0)));\n    \n            // Create a \"Cancel\" button for each purchase\n            JButton cancelButton = new JButton(\"Cancel\");\n            cancelButton.addActionListener(e -> handleCancelAction(purchase));\n            purchasePanel.add(cancelButton);\n    \n            // Add some space between purchases\n            mainPanel.add(purchasePanel);\n            mainPanel.add(Box.createRigidArea(new Dimension(0, 5))); // Adjust as needed\n        }\n    }\n    \n    private void handleCancelAction(Purchase purchase) {\n        // Display a confirmation dialog\n        if(purchase.getInsurance()) {\n            int option = JOptionPane.showConfirmDialog(\n                frame,\n                \"Are you sure you want to cancel the purchase?\\n$\" + purchase.getPrice() + \" will be refunded to your account\",\n                \"Cancel Purchase\",\n                JOptionPane.YES_NO_OPTION);\n                if (option == JOptionPane.YES_OPTION) {\n                    // User clicked \"Yes,\" implement the action to cancel the purchase\n                    System.out.println(\"Cancel action for: \" + purchase.getFirstName() + \" \" + purchase.getLastName());\n                }\n        } else {\n            int option = JOptionPane.showConfirmDialog(\n                frame,\n                \"Are you sure you want to cancel the purchase?\",\n                \"Cancel Purchase\",\n                JOptionPane.YES_NO_OPTION);\n            // Check user's choice\n            if (option == JOptionPane.YES_OPTION) {\n                // User clicked \"Yes,\" implement the action to cancel the purchase\n                System.out.println(\"Cancel action for: \" + purchase.getFirstName() + \" \" + purchase.getLastName());\n            }\n        }\n\n        int rowsDeleted = DatabaseController.CancelBooking(purchase);\n        if(rowsDeleted != 0) {\n            JOptionPane.showConfirmDialog(\n                frame,\n                \"Booking cancelled successfully\",\n                \"Booking Cancelled\",\n                JOptionPane.CLOSED_OPTION);\n\n                frame.dispose();\n        }\n        User.removePurchase(purchase);\n        \n    }\n\n    public void display() {\n        // Show the frame\n        SwingUtilities.invokeLater(() -> {\n            frame.setVisible(true);\n        });\n    }\n\n    public void sendEmail() {\n        // IMPLEMENT SIGN UP CONFIMRATION EMAIL\n        // Send email to USER.getEmail()\n    }\n}"
}